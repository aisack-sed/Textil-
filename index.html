<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Esc√°ner r√°pido de color ‚Äì FIX</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:system-ui,Arial;margin:0;padding:14px}
button{width:100%;padding:16px;font-size:18px;font-weight:900;border-radius:14px;border:0;background:#0b5cff;color:#fff}
.box{margin-top:16px;border:2px solid #ddd;border-radius:16px;padding:12px}
.sample{height:120px;border-radius:14px;border:1px solid #ccc}
.name{font-size:22px;font-weight:900;margin-top:8px}
.code{font-size:18px;color:#555}
.note{font-size:12px;color:#666}
</style>
</head>
<body>

<h2>üßµ Esc√°ner r√°pido de color (versi√≥n estable)</h2>

<button id="scan">üì∏ Escanear color</button>

<div id="out" class="box" style="display:none">
  <div id="sample" class="sample"></div>
  <div id="name" class="name"></div>
  <div id="code" class="code"></div>
  <div class="note">Color aproximado seg√∫n la luz</div>
</div>

<video id="video" autoplay playsinline muted style="display:none"></video>

<script>
const colores={
 "BLANCO":"#ffffff|100",
 "NEGRO":"#111111|900",
 "ROJO":"#d32f2f|261",
 "AZUL":"#1565c0|498",
 "AZUL MARINO":"#0d47a1|490",
 "VERDE BENETTON":"#2e7d32|570",
 "VERDE INGLES":"#388e3c|560",
 "TURQUESA":"#00bcd4|450",
 "GRIS":"#9e9e9e|711",
 "BEIGE":"#e8dcc8|610",
 "BORDO":"#7b1f1f|382",
 "ROSA":"#e91e63|218"
};

const btn=document.getElementById("scan");
const video=document.getElementById("video");

btn.onclick=async()=>{
 try{
   const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
   video.srcObject=stream;
   setTimeout(()=>capturar(stream),700);
 }catch(e){
   alert("‚ö†Ô∏è Abr√≠ este archivo con Chrome y acept√° el permiso de c√°mara");
 }
};

function capturar(stream){
 const c=document.createElement("canvas");
 c.width=80;c.height=80;
 const ctx=c.getContext("2d");
 ctx.drawImage(video,0,0,80,80);
 const d=ctx.getImageData(30,30,20,20).data;

 let r=0,g=0,b=0,n=0;
 for(let i=0;i<d.length;i+=4){r+=d[i];g+=d[i+1];b+=d[i+2];n++}
 r=Math.round(r/n);g=Math.round(g/n);b=Math.round(b/n);

 stream.getTracks().forEach(t=>t.stop());

 let mejor="",distMin=1e9,hex="",code="";
 for(const k in colores){
   const [h,cod]=colores[k].split("|");
   const cr=parseInt(h.substr(1,2),16);
   const cg=parseInt(h.substr(3,2),16);
   const cb=parseInt(h.substr(5,2),16);
   const d=Math.hypot(r-cr,g-cg,b-cb);
   if(d<distMin){distMin=d;mejor=k;hex=h;code=cod}
 }

 document.getElementById("sample").style.background=hex;
 document.getElementById("name").textContent=mejor;
 document.getElementById("code").textContent="C√≥digo: "+code;
 document.getElementById("out").style.display="block";
}
</script>

</body>
</html>
